<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Closet Archive â€” SKU Portal</title>
  <link rel="icon" type="image/png" href="{% static 'favicon.png' %}">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{% static 'brand.css' %}">
  <script>
    // Theme handling: apply at earliest to avoid FOUC
    function applyTheme(theme){
      const html = document.documentElement;
      const body = document.body;
      html.classList.remove('dark','light');
      html.classList.add(theme);
      // Body palette swap
      if(body){
        body.classList.remove('bg-slate-900','text-slate-100','brand-gradient','bg-slate-100','text-slate-900');
        if(theme === 'dark'){
          body.classList.add('bg-slate-900','text-slate-100','brand-gradient');
        } else {
          body.classList.add('bg-slate-100','text-slate-900');
        }
      }
    }
    const savedTheme = localStorage.getItem('theme') || 'dark';
    // Set <html> theme class ASAP to reduce FOUC
    document.documentElement.classList.remove('dark','light');
    document.documentElement.classList.add(savedTheme);
    // Defer body class manipulation until DOM is ready
    document.addEventListener('DOMContentLoaded', () => applyTheme(savedTheme));
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
  </style>
</head>
<body class="min-h-screen">
  <nav class="sticky top-0 z-50 backdrop-blur-md bg-white/70 dark:bg-slate-900/70 border-b border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-100">
    <div class="max-w-6xl mx-auto px-4 py-2 flex items-center gap-4">
      <a href="/" class="flex items-center gap-2">
        <picture>
          <source srcset="{% static 'branding/logo_neon.png' %}" media="(prefers-color-scheme: dark)">
          <img src="{% static 'branding/logo_pop.png' %}" alt="Closet Archive" class="h-10 w-auto logo-drop select-none">
        </picture>
      </a>
      <span class="text-sm text-slate-400">SKU Portal</span>
      <div class="ml-auto flex items-center gap-2">
        {% url 'inventory:dashboard' as dash_url %}
        {% url 'inventory:home' as home_url %}
        {% if request.path == dash_url %}
          <a href="{{ home_url }}" class="px-3 py-2 rounded-2xl bg-white/10 hover:bg-white/20 text-center">Home</a>
        {% else %}
          <a href="{{ dash_url }}" class="px-3 py-2 rounded-2xl bg-white/10 hover:bg-white/20 text-center">Dashboard</a>
        {% endif %}
        <a href="{% url 'inventory:product_create' %}" class="btn btn-primary text-center">New Product</a>
        <a href="{% url 'inventory:export_csv' %}" class="hidden sm:inline-flex px-3 py-2 rounded-2xl bg-white/10 hover:bg-white/20 text-center">CSV</a>
        <a href="{% url 'inventory:export_xlsx' %}" class="hidden sm:inline-flex px-3 py-2 rounded-2xl bg-white/10 hover:bg-white/20 text-center">XLSX</a>
        <button id="themeToggle" class="px-3 py-2 rounded-2xl bg-white/10 hover:bg-white/20" title="Toggle theme">ðŸŒ“</button>
      </div>
    </div>
  </nav>
  <main class="max-w-6xl mx-auto p-4">
    {% for message in messages %}
      <div class="mb-3 p-3 rounded-xl border text-sm bg-emerald-100 text-emerald-900 border-emerald-300 dark:bg-emerald-500/10 dark:text-emerald-200 dark:border-emerald-400/30">{{ message }}</div>
    {% endfor %}
    {% block content %}{% endblock %}
  </main>
  <footer class="max-w-6xl mx-auto px-4 py-10 text-sm text-slate-400">
    Closet Archive â€” Crafted with Django + Tailwind.
  </footer>
  <script>
    document.getElementById('themeToggle').addEventListener('click', ()=>{
      const current = (localStorage.getItem('theme') || 'dark');
      const next = current === 'dark' ? 'light' : 'dark';
      localStorage.setItem('theme', next);
      applyTheme(next);
    });

    // Reveal on scroll + count-up numbers + progress width
    (function(){
      const onReady = (fn)=> document.readyState !== 'loading' ? fn() : document.addEventListener('DOMContentLoaded', fn);
      onReady(()=>{
        const revealEls = document.querySelectorAll('.reveal, .stagger');
        if('IntersectionObserver' in window){
          const io = new IntersectionObserver((entries)=>{
            entries.forEach(e=>{
              if(e.isIntersecting){ e.target.classList.add('in-view'); io.unobserve(e.target); }
            });
          }, { threshold: .1 });
          revealEls.forEach(el=> io.observe(el));
        } else {
          revealEls.forEach(el=> el.classList.add('in-view'));
        }

        // Count-up numbers
        const ease = t => t<.5 ? 2*t*t : 1-(-2*t+2)**2/2;
        document.querySelectorAll('.countup').forEach(el =>{
          const target = parseFloat(el.getAttribute('data-target')||'0');
          const decimals = parseInt(el.getAttribute('data-decimals')||'0',10);
          const prefix = el.getAttribute('data-prefix')||'';
          const suffix = el.getAttribute('data-suffix')||'';
          let start = null;
          const dur = 900;
          const step = (ts)=>{
            if(!start) start = ts;
            let p = Math.min(1, (ts-start)/dur);
            const val = target * ease(p);
            el.textContent = prefix + val.toFixed(decimals) + suffix;
            if(p<1) requestAnimationFrame(step);
          }
          // Trigger when in view if possible
          const run = ()=> requestAnimationFrame(step);
          if('IntersectionObserver' in window){
            const o = new IntersectionObserver((ents)=>{ if(ents[0].isIntersecting){ run(); o.disconnect(); } }, {threshold:.2});
            o.observe(el);
          } else { run(); }
        });

        // Animate progress widths
        document.querySelectorAll('.progress > span[data-width]').forEach(bar=>{
          const width = bar.getAttribute('data-width');
          const run = ()=>{ requestAnimationFrame(()=> bar.style.width = width); };
          if('IntersectionObserver' in window){
            const o2 = new IntersectionObserver((ents)=>{ if(ents[0].isIntersecting){ run(); o2.disconnect(); } }, {threshold:.2});
            o2.observe(bar);
          } else { run(); }
        });

        // Tilt effect for widgets (subtle parallax)
        const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if(!reduceMotion){
          const widgets = Array.from(document.querySelectorAll('.widget'));
          const tiltMax = 6; // degrees
          widgets.forEach(w => {
            w.setAttribute('data-tilt','');
            let raf = null;
            let targetRX = 0, targetRY = 0;
            const onMove = (e)=>{
              const rect = w.getBoundingClientRect();
              const cx = rect.left + rect.width/2;
              const cy = rect.top + rect.height/2;
              const dx = (e.clientX - cx) / rect.width;
              const dy = (e.clientY - cy) / rect.height;
              targetRY = Math.max(-tiltMax, Math.min(tiltMax, dx * tiltMax));
              targetRX = Math.max(-tiltMax, Math.min(tiltMax, -dy * tiltMax));
              if(!raf){ raf = requestAnimationFrame(apply); }
            };
            const onLeave = ()=>{
              targetRX = 0; targetRY = 0;
              if(!raf){ raf = requestAnimationFrame(apply); }
            };
            const apply = ()=>{
              w.style.transform = `rotateX(${targetRX}deg) rotateY(${targetRY}deg)`;
              raf = null;
            };
            w.addEventListener('mousemove', onMove);
            w.addEventListener('mouseleave', onLeave);
          });
        }
        // Button ripple
        document.addEventListener('click', (e)=>{
          const btn = e.target.closest('.btn');
          if(!btn) return;
          const rect = btn.getBoundingClientRect();
          const ripple = document.createElement('span');
          ripple.className = 'ripple';
          ripple.style.left = (e.clientX - rect.left) + 'px';
          ripple.style.top = (e.clientY - rect.top) + 'px';
          btn.appendChild(ripple);
          setTimeout(()=> ripple.remove(), 650);
        });

        // Sparkles removed per request
      });
    })();
  </script>
</body>
</html>
