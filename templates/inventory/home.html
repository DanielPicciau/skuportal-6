{% extends 'base.html' %}
{% block content %}
  <div class="grid grid-cols-1 md:grid-cols-12 gap-4 stagger">
    <!-- Hero / Welcome -->
    <div class="md:col-span-12 rounded-2xl border border-white/10 p-6 bg-gradient-to-r from-indigo-500/10 via-fuchsia-500/10 to-emerald-500/10 reveal">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight neon">Welcome back ðŸ‘‹</h1>
      <p class="text-slate-300 mt-1">Small steps, big wins. Keep listing â€” every item moves you closer to your goals.</p>
    </div>

    <!-- Row 2: Profit + Stock (5 + 7 = 12) -->
    <div class="md:col-span-5 widget p-5 reveal">
      <div class="widget-accent accent-emerald"></div>
      <div class="flex items-center justify-between">
        <div class="text-sm muted">Total Profit (Sold)</div>
        <div class="text-xl">ðŸ’·</div>
      </div>
      <div class="metric-lg mt-2">Â£<span class="countup" data-target="{{ total_profit|floatformat:2 }}" data-decimals="2"></span></div>
      <div class="mt-2 muted text-sm">Net after platform fees and cost.</div>
      <!-- Tiny sparkline -->
      <svg class="mt-3 w-full h-10" viewBox="0 0 120 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <linearGradient id="gradP" x1="0" y1="0" x2="120" y2="0" gradientUnits="userSpaceOnUse">
            <stop stop-color="#10b981"/>
            <stop offset="1" stop-color="#34d399"/>
          </linearGradient>
        </defs>
        <path d="M2 32 C 15 28, 25 22, 35 25 C 45 28, 55 15, 65 18 C 75 21, 90 10, 118 8" stroke="url(#gradP)" stroke-width="2" stroke-linecap="round" fill="none">
          <animate attributeName="stroke-dasharray" from="0,200" to="200,0" dur="1.2s" fill="freeze" />
        </path>
      </svg>
    </div>
    <!-- Stock Value (List) -->
    <div class="md:col-span-7 widget p-5 reveal">
      <div class="widget-accent accent-blue"></div>
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm muted">Current Stock (List Value)</div>
          <div class="text-2xl font-bold mt-1">Â£<span class="countup" data-target="{{ stock_list_value|floatformat:2 }}" data-decimals="2"></span></div>
        </div>
        <div class="text-sm muted">Inventory Cost: <span class="font-semibold">Â£<span class="countup" data-target="{{ stock_cost_value|floatformat:2 }}" data-decimals="2"></span></span></div>
      </div>
      <div class="mt-3 grid grid-cols-2 md:grid-cols-3 gap-2 text-sm text-slate-300">
        <div class="card p-3">
          <div class="muted">Potential Revenue (Listed)</div>
          <div class="text-lg font-semibold">Â£<span class="countup" data-target="{{ listed_list_value|floatformat:2 }}" data-decimals="2"></span></div>
        </div>
        <div class="card p-3">
          <div class="muted">Avg Margin (Sold)</div>
          <div class="text-lg font-semibold"><span class="countup" data-target="{{ avg_margin|floatformat:1 }}" data-decimals="1" data-suffix="%"></span></div>
        </div>
        <div class="card p-3">
          <div class="muted">Variants</div>
          <div class="text-lg font-semibold"><span class="countup" data-target="{{ totals.variants|default:0 }}" data-decimals="0"></span></div>
        </div>
      </div>
    </div>

    <!-- Row 3: 4 Metrics (3 + 3 + 3 + 3 = 12) -->
    <div class="md:col-span-3 widget p-5 reveal">
      <div class="widget-accent accent-blue"></div>
      <div class="text-sm muted">Sold</div>
      <div class="text-3xl font-bold mt-1"><span class="countup" data-target="{{ totals.sold|default:0 }}" data-decimals="0"></span></div>
    </div>
    <div class="md:col-span-3 widget p-5 reveal">
      <div class="widget-accent accent-violet"></div>
      <div class="text-sm muted">On Sale</div>
      <div class="text-3xl font-bold mt-1"><span class="countup" data-target="{{ totals.listed|default:0 }}" data-decimals="0"></span></div>
    </div>
    <div class="md:col-span-3 widget p-5 reveal">
      <div class="widget-accent accent-amber"></div>
      <div class="text-sm muted">Drafts</div>
      <div class="text-3xl font-bold mt-1"><span class="countup" data-target="{{ totals.draft|default:0 }}" data-decimals="0"></span></div>
    </div>
    <div class="md:col-span-3 widget p-5 reveal">
      <div class="widget-accent accent-pink"></div>
      <div class="text-sm muted">Products</div>
      <div class="text-3xl font-bold mt-1"><span class="countup" data-target="{{ totals.products|default:0 }}" data-decimals="0"></span></div>
    </div>

    <!-- Row 4: Milestone + Categories (7 + 5 = 12) -->
    <div class="md:col-span-7 widget p-5 reveal">
      <div class="widget-accent accent-violet"></div>
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm muted">Next Profit Milestone</div>
          <div class="text-xl font-semibold">
            {% if next_target %}
              Â£{{ total_profit|floatformat:2 }} / Â£{{ next_target|floatformat:2 }}
            {% else %}
              You smashed all milestones â€” time for a new goal! ðŸŽ‰
            {% endif %}
          </div>
        </div>
        {% if next_target %}
        <div class="w-72 progress">
          <span data-width="{{ progress_pct }}%"></span>
        </div>
        {% endif %}
      </div>
      <p class="text-sm muted mt-3">Tip: Refresh older listings with better photos and keywords to boost conversions.</p>
    </div>

    <!-- Top Categories -->
    <div class="md:col-span-5 widget p-5 reveal">
      <div class="widget-accent accent-amber"></div>
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-semibold">Top Categories (Sold)</h2>
        <a href="{% url 'inventory:dashboard' %}" class="text-sm underline">Dashboard â†’</a>
      </div>
      <div class="space-y-2">
        {% for row in top_categories %}
          <div class="list-row">
            <div class="list-title">{{ row.category }}</div>
            <div class="flex items-center gap-2">
              <div class="w-28 progress"><span data-width="{{ row.pct }}%"></span></div>
              <span class="badge">{{ row.count }}</span>
            </div>
          </div>
        {% empty %}
          <div class="text-slate-400">No sales yet â€” your first is around the corner.</div>
        {% endfor %}
      </div>
    </div>

    <!-- Row 5: Recent + Top Brands (8 + 4 = 12) -->
    <div class="md:col-span-8 widget p-5 reveal">
      <div class="widget-accent accent-blue"></div>
      <h2 class="text-xl font-semibold mb-3">Recent Activity</h2>
      <div class="divide-y divide-white/10">
        {% for v in recent %}
          <div class="py-2 flex items-center gap-3">
            <div class="text-xs font-mono bg-white/10 rounded px-2 py-1">{{ v.variant_sku }}</div>
            <div class="flex-1">
              <div class="text-slate-200">{{ v.product.name }}</div>
              <div class="text-slate-400 text-xs">{{ v.product.brand }} â€¢ {{ v.product.category }} â€¢ {{ v.size }} â€¢ {{ v.status }}</div>
            </div>
            {% if v.status == 'Sold' %}
              <div class="text-emerald-400">Â£{{ v.profit|floatformat:2 }} profit</div>
            {% else %}
              <div class="text-slate-400">Â£{{ v.price|floatformat:2 }} listed</div>
            {% endif %}
          </div>
        {% empty %}
          <div class="text-slate-400">No activity yet.</div>
        {% endfor %}
      </div>
    </div>

    <!-- Top Brands -->
    <div class="md:col-span-4 widget p-5 reveal">
      <div class="widget-accent accent-pink"></div>
      <h2 class="text-xl font-semibold mb-3">Top Brands (Sold)</h2>
      <div class="space-y-2">
        {% for row in top_brands %}
          <div class="list-row">
            <div class="list-title">{{ row.product__brand }}</div>
            <div>
              <span class="badge">{{ row.count }}</span>
              <span class="muted text-sm ml-2">Â£{{ row.profit|floatformat:2 }}</span>
            </div>
          </div>
        {% empty %}
          <div class="text-slate-400">No brands yet.</div>
        {% endfor %}
      </div>
    </div>

    <!-- Row 6: Quick Actions full width to avoid gaps -->
    <div class="md:col-span-12 widget p-5 reveal">
      <div class="widget-accent accent-emerald"></div>
      <h2 class="text-xl font-semibold mb-3">Quick Actions</h2>
      <div class="grid grid-cols-2 gap-2">
        <a href="{% url 'inventory:product_create' %}" class="btn btn-primary text-center">New Product</a>
        <a href="{% url 'inventory:dashboard' %}" class="px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/20 text-center col-span-1">Open Dashboard</a>
        <a href="{% url 'inventory:export_csv' %}" class="px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/20 text-center">Export CSV</a>
      </div>
      <div class="mt-4 text-slate-300 text-sm">
        Aim for 1 listing a day. Your future self will thank you.
      </div>
    </div>
  </div>
{% endblock %}
